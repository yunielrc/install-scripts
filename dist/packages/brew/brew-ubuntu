#!/usr/bin/env bash

set -euEo pipefail

# Idempotent
[[ -x /home/linuxbrew/.linuxbrew/bin/brew ]] && {
  echo 'brew currently installed'
  exit 0
}

# Dependencies
sudo apt-get update -y
sudo apt-get install -y build-essential curl file git

# TODO: brew se instala pero despu√©s da error al instalar un paquete manualmente
# Install
curl -fsSL 'https://raw.githubusercontent.com/Homebrew/install/master/install.sh' | bash

# Configure
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"

cat <<'EOF' >> ~/.bashrc

# BREW
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
# export LDFLAGS="-L/home/linuxbrew/.linuxbrew/opt/isl@0.18/lib"
# export CPPFLAGS="-I/home/linuxbrew/.linuxbrew/opt/isl@0.18/include"

## brew completions
if type brew &>/dev/null; then
  HOMEBREW_PREFIX="$(brew --prefix)"
  if [[ -r "${HOMEBREW_PREFIX}/etc/profile.d/bash_completion.sh" ]]; then
    source "${HOMEBREW_PREFIX}/etc/profile.d/bash_completion.sh"
  else
    for COMPLETION in "${HOMEBREW_PREFIX}/etc/bash_completion.d/"*; do
      [[ -r "$COMPLETION" ]] && source "$COMPLETION"
    done
  fi
fi
# :BREW
EOF
